"use strict";(self.webpackChunkchemotion_saurus=self.webpackChunkchemotion_saurus||[]).push([[5852],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),d=r,h=u["".concat(l,".").concat(d)]||u[d]||m[d]||o;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2286:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return u}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],s={id:"native_installation",title:"Native Installation",sidebar_label:"Native installation",slug:"native_installation"},l=void 0,p={unversionedId:"eln/native_installation",id:"version-1.1.0/eln/native_installation",title:"Native Installation",description:"Documentation and processes are being reworked and improved at the moment. It may happen that you miss information. If you face problems, please let us know, we are there to support you. You may also contact us directly if you plan to install Chemotion.",source:"@site/versioned_docs/version-1.1.0/eln/native_installation.mdx",sourceDirName:"eln",slug:"/eln/native_installation",permalink:"/chemotionsaurus/docs/1.1.0/eln/native_installation",editUrl:"https://github.com/ComPlat/chemotion_saurus/edit/master/versioned_docs/version-1.1.0/eln/native_installation.mdx",tags:[],version:"1.1.0",lastUpdatedBy:"Danny Truong",lastUpdatedAt:1649919296,formattedLastUpdatedAt:"4/14/2022",frontMatter:{id:"native_installation",title:"Native Installation",sidebar_label:"Native installation",slug:"native_installation"},sidebar:"version-1.1.0/elnSidebar",previous:{title:"Introduction Videos",permalink:"/chemotionsaurus/docs/1.1.0/eln/videos_eln"},next:{title:"Docker installation",permalink:"/chemotionsaurus/docs/1.1.0/eln/docker_installation"}},c=[{value:"Hardware Requirement",id:"hardware-requirement",children:[],level:2},{value:"Nginx - Phusion passenger",id:"nginx---phusion-passenger",children:[],level:2},{value:"Application File &amp; Directory Structure",id:"application-file--directory-structure",children:[{value:"File storage",id:"file-storage",children:[],level:3},{value:"DB settings",id:"db-settings",children:[],level:3}],level:2},{value:"Multiple Machine Configuration",id:"multiple-machine-configuration",children:[{value:"DB Setup:",id:"db-setup",children:[],level:3},{value:"ELN Web App Setup:",id:"eln-web-app-setup",children:[],level:3},{value:"ELN Web Worker Setup:",id:"eln-web-worker-setup",children:[],level:3},{value:"ELN Web Proxy Setup:",id:"eln-web-proxy-setup",children:[],level:3}],level:2}],m={toc:c};function u(e){var t=e.components,s=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Documentation and processes are being reworked and improved at the moment. It may happen that you miss information. If you face problems, please let us know, we are there to support you. You may also ",(0,o.kt)("a",{parentName:"p",href:"specific_contact"},"contact")," us directly if you plan to install Chemotion. "))),(0,o.kt)("p",null,"This documentation detailled an installation solution example of the the chemotion_ELN system and associated services on Ubuntu servers."),(0,o.kt)("p",null,"The chemotion_ELN is a web-application that needs the following elements:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"web-server and application server: NGINX with Passenger-phusion"),(0,o.kt)("li",{parentName:"ul"},"DB: postgresql (>10)"),(0,o.kt)("li",{parentName:"ul"},"the web application itself"),(0,o.kt)("li",{parentName:"ul"},"worker-applications to execute background tasks"),(0,o.kt)("li",{parentName:"ul"},"disk space to store attachment files from the users")),(0,o.kt)("p",null,"The code for the web-application (server- and client- sides) and the workers is what we provide."),(0,o.kt)("p",null,"For a few users, all this components can be installed on a single machine (2 cpu s, 3GB memory) using the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ComPlat/chemotion_ELN/blob/development/scripts/install_production.sh"},"installation script")," that will set up all these components and basic configurations."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"We should be more precise here and make a recommendation up to what number of users the installation on a machine is good for;\nInstallation with root or sudo user"))),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"architecture_ELN",src:n(1257).Z,width:"283",height:"592"})),(0,o.kt)("p",null,"In short the installation, will:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"install OS package dependencies"),(0,o.kt)("li",{parentName:"ul"},"install passenger"),(0,o.kt)("li",{parentName:"ul"},"create a new user"),(0,o.kt)("li",{parentName:"ul"},"install ruby and nodejs for this user"),(0,o.kt)("li",{parentName:"ul"},"create a postgresql DB"),(0,o.kt)("li",{parentName:"ul"},"copy the chemotion_ELN code and prepare basic config files"),(0,o.kt)("li",{parentName:"ul"},"do a capistrano app deploy"),(0,o.kt)("li",{parentName:"ul"},"config nginx (NB: no ssl set) and UFW")),(0,o.kt)("p",null,"For more users, one can start to split the services onto distinct machines."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"From how many users does this make sense? What advantages do I have?"),(0,o.kt)("p",{parentName:"div"},"The link to the installation scripts for the different machines is missing. On the end of the page are important information -> link possible?"),(0,o.kt)("p",{parentName:"div"},"How do I install Chemotion if several working groups at one university / from different universities want to access Chemotion? Does each working group have to install everything completely? Can I save the data of the working groups on different computers? "))),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"architecture_ELN_dist",src:n(440).Z,width:"903",height:"1063"})),(0,o.kt)("h2",{id:"hardware-requirement"},"Hardware Requirement"),(0,o.kt)("p",null,"To install on a single machine for few users below is the minimum hardware requirement."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"3GB RAM"),(0,o.kt)("li",{parentName:"ul"},"Dual Core"),(0,o.kt)("li",{parentName:"ul"},"50-100GB hard disk "),(0,o.kt)("li",{parentName:"ul"},"Ubuntu 20.04LTS or 18.04 LTS")),(0,o.kt)("p",null,"For multiple machine configuration and splitting the services onto different machines below is the hardware requirement:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"ELN web and worker server"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"3GB RAM"),(0,o.kt)("li",{parentName:"ul"},"Dual Core"),(0,o.kt)("li",{parentName:"ul"},"10-20GB hard disk"),(0,o.kt)("li",{parentName:"ul"},"Ubuntu 20.04LTS or 18.04 LTS")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"DB server"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"2GB RAM"),(0,o.kt)("li",{parentName:"ul"},"Dual Core"),(0,o.kt)("li",{parentName:"ul"},"500GB hard disk or smaller (depending upon the size of the metadata)"),(0,o.kt)("li",{parentName:"ul"},"Ubuntu 20.04LTS or 18.04 LTS")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"ELN proxy server"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"2GB RAM"),(0,o.kt)("li",{parentName:"ul"},"Dual Core"),(0,o.kt)("li",{parentName:"ul"},"8GB hard disk"),(0,o.kt)("li",{parentName:"ul"},"Ubuntu 20.04LTS or 18.04 LTS")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Where are the research data and entries stored in Chemotion? If the installation is done on multiple machines, Chemotion will have more users and consequently more data. Shouldn't the DB server have more hard disk or at least 500 GB?"))),(0,o.kt)("h2",{id:"nginx---phusion-passenger"},"Nginx - Phusion passenger"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},'The information density here is very high, and i think that single subheadings would help, e.g. "Use of SSL" here.\nAnother point, e.g. Use of a server name'))),(0,o.kt)("p",null,"The configuration files are at /etc/nginx/sites-enabled/ (symlinked from ../sites-available).\nSSL use is recommended and should be set there."),(0,o.kt)("p",null,"To help with building the ssl config, one can use the ",(0,o.kt)("a",{parentName:"p",href:"https://ssl-config.mozilla.org/"},"configurator from Mozilla")),(0,o.kt)("p",null,"Copy or edit your currently enabled config (/etc/nginx/sites-available/...) to change the listening port from 80 to 443 and set the path to the certificates for an example to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'server {\n        listen 443 ssl http2;\n        listen [::]:443 ssl http2;\n# SSL config\n        ssl_certificate /path/to/signed_cert_plus_intermediates;\n        ssl_certificate_key /path/to/private_key;\n        # ssl_trusted_certificate /path/to/interm;\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:MozSSL:1m;\n\n       ssl_protocols TLSv1.2 TLSv1.3;\n       ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n       ssl_prefer_server_ciphers off;\n\n       # HSTS\n       add_header Strict-Transport-Security "max-age=63072000" always;\n\n    .....\n\n\n')),(0,o.kt)("p",null,"One can also add  a DH group:"),(0,o.kt)("p",null,"generate the group with  ",(0,o.kt)("inlineCode",{parentName:"p"},"sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 4096")),(0,o.kt)("p",null,"then add it to the nginx server config"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"ssl_dhparam /etc/ssl/certs/dhparam.pem;\n")),(0,o.kt)("p",null,"the rest of the config should be unchanged and similar to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'\n......\n\n# application\n        passenger_enabled on;\n        client_max_body_size xxm;\n        passenger_ruby /home/production/.rvm/wrappers/ruby-x.x.x/ruby;\n        root /var/www/chemotion_ELN/current/public;\n\n        server_name _;\n        # server_name www.my-eln.tld my-eln.tld;\n\n        location / {\n            proxy_pass http://127.0.0.1:xxxx;\n            proxy_http_version 1.1;\n            proxy_set_header Host $http_host;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n            proxy_buffering off;\n        }\n\n}\n\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"force ssl redirection from port 80 to 443"),":\nWith a sudo user, create a file  in  sites-available/. and enable it by linking it into sites-enabled/."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"server {\n  listen 80;\n  listen [::]:80;\n  server_name your_server_name;\n  return      301  https://$server_name$request_uri ;\n}\n\n")),(0,o.kt)("p",null,"test the config (",(0,o.kt)("inlineCode",{parentName:"p"},"sudo nginx -t -c /etc/nginx/nginx.conf"),")  and restart/reload nginx (",(0,o.kt)("inlineCode",{parentName:"p"},"sudo systemctl restart nginx "),")"),(0,o.kt)("h2",{id:"application-file--directory-structure"},"Application File & Directory Structure"),(0,o.kt)("p",null,"With this setup the application code is located at /var/www/chemotion/ELN/current\nThe installation script calls ",(0,o.kt)("a",{parentName:"p",href:"https://capistranorb.com/documentation/overview/what-is-capistrano/"},"Capistrano")," to deploy the Rails app. Because of that, the structure of application files is the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"/var/www/chemotion_ELN/\n\u251c\u2500\u2500 current -> /var/www/chemotion_ELN/releases/202101XXXXXXXX\n\u251c\u2500\u2500 releases\n\u2502\xa0\xa0 \u251c\u2500\u2500 202101XXXXXXXX\n\u2502\xa0\xa0 \u251c\u2500\u2500 202101XXXXXXXX\n\u2502\xa0\xa0 \u2514\u2500\u2500\u2500 202101XXXXXXXX\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 app\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 backup\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 deploy_backup -> /var/www/chemotion_ELN/shared/backup/deploy_backup\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 models\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 weekly_backup -> /var/www/chemotion_ELN/shared/backup/weekly_backup\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 bin\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 config\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 data_collector_keys\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 deploy\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 environments\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 initializers\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 locales\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 unicorn\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 db\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 functions\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 migrate\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 seeds\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 triggers\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 views\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 lib\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 log -> /var/www/chemotion_ELN/shared/log\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 node_modules -> /var/www/chemotion_ELN/shared/node_modules\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 public\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 assets -> /var/www/chemotion_ELN/shared/public/assets\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 images -> /var/www/chemotion_ELN/shared/public/images\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 simulations -> /var/www/chemotion_ELN/shared/public/simulations\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 zip\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 tmp\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 cache -> /var/www/chemotion_ELN/shared/tmp/cache\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 novnc_devices -> /var/www/chemotion_ELN/shared/tmp/novnc_devices\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 pids -> /var/www/chemotion_ELN/shared/tmp/pids\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 sockets -> /var/www/chemotion_ELN/shared/tmp/sockets\n\u2502\xa0\xa0  \xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 uploads -> /var/www/chemotion_ELN/shared/tmp/uploads\n\u2502\xa0\xa0  \xa0\xa0 \u251c\u2500\u2500 uploads -> /var/www/chemotion_ELN/shared/uploads\n\u2502\xa0\xa0  \xa0\xa0 \u2514\u2500\u2500 vendor\n\u2502\xa0\xa0  \xa0\xa0     \u2514\u2500\u2500 assets\n\u251c\u2500\u2500 repo\n\u2502\xa0\xa0 \u251c\u2500\u2500 branches\n\u2502\xa0\xa0 \u251c\u2500\u2500 ...\n\u2502\xa0\xa0 \u2514\u2500\u2500 refs\n\u2502\xa0\xa0     \u251c\u2500\u2500 .. heads\n\u2502\xa0\xa0     \u2514 ..\n\u2514\u2500\u2500 shared\n    \u251c\u2500\u2500 .env\n    \u251c\u2500\u2500 backup\n    \u2502\xa0\xa0 \u251c\u2500\u2500 deploy_backup\n    \u2502\xa0\xa0 \u2514\u2500\u2500 weekly_backup\n    \u251c\u2500\u2500 config\n    \u2502\xa0\xa0 \u251c\u2500\u2500 database.yml\n    \u2502\xa0\xa0 \u2514\u2500\u2500 storage.yml\n    \u251c\u2500\u2500 log\n    \u251c\u2500\u2500 node_modules\n    \u2502\xa0\xa0 \u251c\u2500 ...\n    \u2502\xa0\xa0 ...\n    \u2502\n    \u251c\u2500\u2500 public\n    \u2502\xa0\xa0 \u251c\u2500\u2500 assets\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ...\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ...ketcherails\n    \u2502\xa0\xa0 \u2502\xa0\xa0\n    \u2502\xa0\xa0 \u251c\u2500\u2500 images\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ghs\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 images\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 ketcherails\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 molecules\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 qr\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 reactions\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 research_plans\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 samples\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 sprites\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 templates\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 thumbnail\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 wild_card\n    \u2502\xa0\xa0 \u251c\u2500\u2500 ontologies\n    \u2502\xa0\xa0 \u251c\u2500\u2500 simulations\n    \u2502\xa0\xa0 \u2514\n    \u251c\u2500\u2500 tmp\n    \u2502\xa0\xa0 \u251c\u2500\u2500 cache\n    \u2502\xa0\xa0 \u251c\u2500\u2500 novnc_devices\n    \u2502\xa0\xa0 \u251c\u2500\u2500 pids\n    \u2502\xa0\xa0 \u251c\u2500\u2500 sockets\n    \u2502\xa0\xa0 \u2514\u2500\u2500 uploads\n    \u2514\u2500\u2500 uploads\n\n\n")),(0,o.kt)("p",null,"Configuration files for the application are in the ",(0,o.kt)("em",{parentName:"p"},"config")," directory.\nIn the currently running application directory the configuration files ( ",(0,o.kt)("em",{parentName:"p"},"current/config/*.yml")," ) are linked from ",(0,o.kt)("em",{parentName:"p"},"shared/config/*yml")),(0,o.kt)("p",null,"The web and background-worker applications are started a reboot by executing the script /home/production/boot-ELN.sh from the crontab.\nThe ruby dependencies and node versions are also in the home directory."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"/home/production\n\u251c\u2500\u2500 .nvm\n\u2502\xa0\xa0 \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 .rvm\n\u2502\xa0\xa0 \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 Backup\n\u2514\u2500\u2500 boot-ELN.sh\n\n")),(0,o.kt)("h3",{id:"file-storage"},"File storage"),(0,o.kt)("p",null,"Files uploaded by the users are stored in /var/www/chemotion_ELN/shared/uploads.\nThe path is defined in the storage.yml config."),(0,o.kt)("h3",{id:"db-settings"},"DB settings"),(0,o.kt)("p",null,"Connection to the DB is set in ",(0,o.kt)("em",{parentName:"p"},"config/database.yml"),"."),(0,o.kt)("h2",{id:"multiple-machine-configuration"},"Multiple Machine Configuration"),(0,o.kt)("p",null,"When splitting the tasks on several machines make sure you meet the above ",(0,o.kt)("a",{parentName:"p",href:"#hardware-requirement"},"hardware requirement"),". There should also be a shared directory among all the VMs and should have access for read and write. Following are the files which needs to be accessible to any web-app or worker-app instance"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"DB"),(0,o.kt)("li",{parentName:"ul"},"uploaded user files"),(0,o.kt)("li",{parentName:"ul"},"images")),(0,o.kt)("h3",{id:"db-setup"},"DB Setup:"),(0,o.kt)("p",null,"Chemotion runs on PostgreSQL relational database (version >10).In order to setup DB server we have to install PostgreSQL and create necessary role,DB and extension.\nFollow below steps to setup the DB server."),(0,o.kt)("p",null,"1.Install Postgres"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"sudo apt-get update\nsudo apt-get -y install postgresql-12\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"To check if postgres is correctly installed. Run below command to check the version and status.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"apt show postgresql\nservice postgresql status\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Allow remote connection to postgres.To help doing this you can follow ",(0,o.kt)("a",{parentName:"p",href:"https://www.thegeekstuff.com/2014/02/enable-remote-postgresql-connection/"},"link here"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create DB, Role and Extension"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"NOTE: Perform this step after Step 3 of ELN Web App Setup.")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Create Role:")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"sudo -u postgres psql -c \" CREATE ROLE $DB_ROLE LOGIN CREATEDB NOSUPERUSER PASSWORD '$DB_PW';\"\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Create DB:")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'sudo -u postgres psql -c " CREATE DATABASE $DB_NAME OWNER $DB_ROLE;"\n')),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Create Extension:")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'sudo -u postgres psql -d $DB_NAME -c \' CREATE EXTENSION IF NOT EXISTS "pg_trgm"; CREATE EXTENSION IF NOT EXISTS "hstore";  CREATE EXTENSION IF NOT EXISTS "uuid-ossp";\'\n')),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"NOTE : replace $DB_NAME, $DB_PW and $DB_ROLE by the values  saved in .env file of app_server (/var/www/chemotion_ELN/shared/.env)")))),(0,o.kt)("h3",{id:"eln-web-app-setup"},"ELN Web App Setup:"),(0,o.kt)("p",null,"Follow the below steps to install the ELN application."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Copy the installation script on a Ubuntu server 18.04 or 20.04 LTS"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"curl -o chemotion_ELN_install.sh -L https://raw.githubusercontent.com/ComPlat/chemotion_ELN/development/scripts/install_production.sh\n")),(0,o.kt)("p",{parentName:"li"},"Check the variables at the beginning of the file, but also check the whole script to see what it is doing.\nThis will basically install evrything on one machine but configuration within can be reworked to just serve one purpose.\nThe script will..."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"install OS package dependencies"),(0,o.kt)("li",{parentName:"ul"},"install passenger"),(0,o.kt)("li",{parentName:"ul"},"create a new user"),(0,o.kt)("li",{parentName:"ul"},"install ruby and nodejs for the user"),(0,o.kt)("li",{parentName:"ul"},"create a postgresql DB"),(0,o.kt)("li",{parentName:"ul"},"copy the chemotion_ELN code and prepare basic config files"),(0,o.kt)("li",{parentName:"ul"},"do a capistrano app deploy"),(0,o.kt)("li",{parentName:"ul"},"config nginx (NB: no ssl set) and UFW")),(0,o.kt)("p",{parentName:"li"},"You can also comment out the part from script which you want to skip during the installation.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"When ready, make the script executable and run it as a non-root user (but in the sudo group):"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"chmod 700 chemotion_ELN_install.sh\nsudo ./chemotion_ELN_install.sh\n")),(0,o.kt)("p",{parentName:"li"},"The whole installation process may take approximately an hour to complete. Once done the system should reboot and the application should be up and running at the\nIP of the   machine   (http://...). An admin account should have been created (email: ",(0,o.kt)("a",{parentName:"p",href:"mailto:eln-admin@kit.edu"},"eln-admin@kit.edu"),", pw: PleaseChangeYourPassword)")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Connect to remote DB server by updating the HOST and PORT in database.yml file (",(0,o.kt)("em",{parentName:"p"},"/var/www/chemotion_ELN/shared/config/database.yml"),") or instead update the parameter at\n.env file (",(0,o.kt)("em",{parentName:"p"},"/var/www/chemotion_ELN/shared/.env"),"). ")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once connection is succesfully established follow step 4 of DB Setup to Create DB,Role and Extension.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"After sucessfully completing the DB configuration migrate the DB and restart the app by running below command in app server as production user."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"sudo su production\nsource ~/.profile && cd /var/www/chemotion_ELN/current && RAILS_ENV=production bundle exec rake db:migrate\ntouch /var/www/chemotion_ELN/current/tmp/restart.txt\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once the application is setup, technically we can uninstall the postgres and stop the worker job from this server.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To uninstall PostgreSQL from the app server you can follow the ",(0,o.kt)("a",{parentName:"p",href:"https://askubuntu.com/questions/32730/how-to-remove-postgres-from-my-installation"},"link here"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The worker app (",(0,o.kt)("em",{parentName:"p"},"delayed_job"),") and  the web app (",(0,o.kt)("em",{parentName:"p"},"passenger instance"),") are  started at machine-reboot  through crontab of the production user.\nCrontab will execute at reboot a script located  at ",(0,o.kt)("em",{parentName:"p"},"/home/production/boot-ELN.sh"),". In ordee to stop the worker job comment out the job on the script\nsection (",(0,o.kt)("em",{parentName:"p"},"/home/production/boot-ELN.sh"),") and quit the job(",(0,o.kt)("em",{parentName:"p"},"delayed_job"),") from the process manager as well(",(0,o.kt)("em",{parentName:"p"},"htop"),")."))),(0,o.kt)("h3",{id:"eln-web-worker-setup"},"ELN Web Worker Setup:"),(0,o.kt)("p",null,"Follow the below steps to configure the worker."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Download and execute the installation script as done in Step 1 of app setup. This time you can execute the script by\ncommenting out the Part 2,6,71 and 11. ",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"PART_0='update OS'\nPART_1='deb dependencies installation'\nPART_1_1='deb specific dep version'\n#PART_2='nginx and phusionpassenger installation'\nPART_3='create a ubuntu user'\nPART_4='rvm and ruby installation'\nPART_5='nvm and npm installation'\n#PART_6='prepare postgresql DB'\nPART_7='prepare production app directories and config'\n#PART_71='reset DB pw'\nPART_8='prepare first deploy and deploy application code'\nPART_81='seed common ketcher templates'\nPART_82='seed common reagents'\nPART_9='prepare boot start and log rotation'\nPART_10='configure UFW'\n#PART_11='configure NGINX'\n"))),(0,o.kt)("li",{parentName:"ol"},"Once installation done succesfully you can configure the DB server at .env file (",(0,o.kt)("em",{parentName:"li"},"/var/www/chemotion_ELN/shared/.env"),")."),(0,o.kt)("li",{parentName:"ol"},"To check if installation was successful login as production user and perform below action.",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"source ~/.profile && cd /var/www/chemotion_ELN/current && RAILS_ENV=production bundle exec rails c#then run some ruby rails command:\nPerson.count\nexit\n"))),(0,o.kt)("li",{parentName:"ol"},"You can edit the boot-ELN.sh to only reboot the worker. Now that your worker and app setup is done make sure below files are shared between the VMs\nand have read and write permissions.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"to share btw VMs:")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"/var/www/chemotion_ELN/shared/uploads/\n/var/www/chemotion_ELN/shared/public/images/\n/var/www/chemotion_ELN/shared/tmp/uploads/\n/var/www/chemotion_ELN/shared/public/zip/\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"to share or duplicate:")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"/var/www/chemotion_ELN/shared/config/\n/var/www/chemotion_ELN/shared/.env\n")))),(0,o.kt)("h3",{id:"eln-web-proxy-setup"},"ELN Web Proxy Setup:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Install Nginx "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"sudo apt-get update\nsudo apt-get install nginx\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If you don't have a certificate already, you can grab one for free at ",(0,o.kt)("a",{parentName:"p",href:"https://certbot.eff.org/"},"Let's Encrypt"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Edit default config file in ",(0,o.kt)("em",{parentName:"p"},"/etc/nginx/sites-available/default")," and proxy pass to your app server. You can refer below configuration for reference."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'....\n\nserver {\n\n    listen [::]:443 ssl ipv6only=on; # managed by Certbot\n    listen 443 ssl; # managed by Certbot\n    \n    #SSL Certificate\n    ssl_certificate __path_to_certificate__; # managed by Certbot\n    ssl_certificate_key __path_to_certificate_key__; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n    \n             # Add index.php to the list if you are using PHP\n             index index.html index.htm index.nginx-debian.html;\n             server_name your_domain; # managed by Certbot\n\n             location / {\n                     proxy_pass http://(_your_app_domain_):8080;\n                     proxy_http_version 1.1;\n                     proxy_set_header Upgrade $http_upgrade;\n                     proxy_set_header Connection "upgrade";\n                     proxy_set_header Host $http_host;\n                     proxy_set_header X-Real-IP $remote_addr;\n                     proxy_set_header X-Nginx-Proxy true;\n                     proxy_redirect off;\n             }\n\n       } \nserver {\n             if ($host = application.chemotion.uni-jena.de) {\n                     return 301 https://$host$request_uri;\n             } # managed by Certbot\n\n             listen 80 ;\n             listen [::]:80 ;\n             server_name _your_domain_;\n             return 404; # managed by Certbot\n       }\n\n....\n')))))}u.isMDXComponent=!0},1257:function(e,t,n){t.Z=n.p+"assets/images/architecture_ELN_base-099e78fdeac84452afa5cdaeaf0c31a5.svg"},440:function(e,t,n){t.Z=n.p+"assets/images/architecture_ELN_dist-c6c03e6f2158d7d131566eae05be0a55.svg"}}]);