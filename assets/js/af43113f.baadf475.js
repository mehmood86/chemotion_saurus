"use strict";(self.webpackChunkchemotion_saurus=self.webpackChunkchemotion_saurus||[]).push([[4962],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||i;return n?o.createElement(h,r(r({ref:t},d),{},{components:n})):o.createElement(h,r({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1614:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return d},default:function(){return u}});var o=n(7462),a=n(3366),i=(n(7294),n(3905)),r=["components"],l={id:"dockerinstall",title:"Docker Installation",sidebar_label:"Docker installation",slug:"docker_installation"},s=void 0,p={unversionedId:"eln/dockerinstall",id:"eln/dockerinstall",title:"Docker Installation",description:"Documentation and processes are being reworked and improved at the moment. It may happen that you miss information. If you face problems, please let us know, we are there to support you. You may also contact us directly if you plan to install Chemotion.",source:"@site/docs/eln/docker-installation.md",sourceDirName:"eln",slug:"/eln/docker_installation",permalink:"/chemotionsaurus/docs/next/eln/docker_installation",editUrl:"https://github.com/ComPlat/chemotion_saurus/edit/master/docs/eln/docker-installation.md",tags:[],version:"current",lastUpdatedBy:"ptrxyz",lastUpdatedAt:1649101436,formattedLastUpdatedAt:"4/4/2022",frontMatter:{id:"dockerinstall",title:"Docker Installation",sidebar_label:"Docker installation",slug:"docker_installation"},sidebar:"elnSidebar",previous:{title:"Native installation",permalink:"/chemotionsaurus/docs/next/eln/native_installation"},next:{title:"Native installation",permalink:"/chemotionsaurus/docs/next/eln/development_native_installation"}},d=[{value:"Version 1.1.2p220401",id:"version-112p220401",children:[{value:"Fresh Installation",id:"fresh-installation",children:[],level:3},{value:"Upgrade from 1.0.3D0.1",id:"upgrade-from-103d01",children:[],level:3},{value:"Configuring",id:"config-112p220401",children:[],level:3},{value:"Setting the Base-URL",id:"baseurl-112p220401",children:[],level:3},{value:"Other Documentation",id:"other-documentation",children:[{value:"Notes on Backups:",id:"notes-on-backups",children:[],level:4}],level:3}],level:2},{value:"Version 1.0.3D0.1",id:"version-103d01",children:[],level:2},{value:"Preparation",id:"preparation",children:[],level:2},{value:"Running Chemotion",id:"running-chemotion",children:[],level:2},{value:"Managing your instance",id:"managing-your-instance",children:[{value:"Basic Information",id:"basic-information",children:[],level:3},{value:"Getting a shell inside the container",id:"getting-a-shell-inside-the-container",children:[],level:3}],level:2},{value:"Backing up your data",id:"backing-up-your-data",children:[],level:2},{value:"Upgrading",id:"upgrading",children:[{value:"Setting up a Reverse-Proxy",id:"setting-up-a-reverse-proxy",children:[],level:3}],level:2}],c={toc:d};function u(e){var t=e.components,n=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Documentation and processes are being reworked and improved at the moment. It may happen that you miss information. If you face problems, please let us know, we are there to support you. You may also ",(0,i.kt)("a",{parentName:"p",href:"specific_contact"},"contact")," us directly if you plan to install Chemotion. "))),(0,i.kt)("h2",{id:"version-112p220401"},"Version 1.1.2p220401"),(0,i.kt)("p",null,'To install version 1.1.2 of the ELN, we introduce the container version 1.1.2p220401. Please note, the naming convention cahnged to now encode the ELN version (1.1.2) followed by a single character to denote the intended use ("p" for production, "d" for development and "e" for experimental) followed by the version of the Docker middleware in the form of "YYMMRR" with RR being an increaseing integer.'),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"From this version onwards, spectra analysis services will be included into the default setup. If you do not like that, you can edit the Compose file accordingly.  "))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"From this version onwards, we rely on Docker volumes to preserve data. Your user data will be stored in the volumes ",(0,i.kt)("inlineCode",{parentName:"p"},"chemotion_data")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"chemotion_db"),". DO NOT delete them if you like your stuff. No backup, no pity."))),(0,i.kt)("h3",{id:"fresh-installation"},"Fresh Installation"),(0,i.kt)("p",null,"To install this version on a blank system, follow these steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"download the ",(0,i.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," to a directory of your choice:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"wget https://raw.githubusercontent.com/ptrxyz/chemotion/main/new-build/release/1.1.2p220401/docker-compose.yml\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"download all images and create the containers, data volumes and networks by running this command in the same folder you downloaded the compose file to:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose create\n")),(0,i.kt)("p",null,"Note: depending on your Compose version you might get a deprecation warning. The warning can be ignored for now, in the future, ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose up --no-start")," will be a drop-in replacement for this command."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Start the ELN containers with")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose up\n")),(0,i.kt)("p",null,"or "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose up -d\n")),(0,i.kt)("p",null,"(the 1st command outputs to stdout, the 2nd starts the ELN as a background service loggin to the docker's log daemon)"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"after a short startup/migration period, the ELN will available on port ",(0,i.kt)("inlineCode",{parentName:"li"},"<your host IP>:4000")),(0,i.kt)("li",{parentName:"ul"},"Proceed with the sections ",(0,i.kt)("a",{parentName:"li",href:"#config-112p220401"},"Configuring")," and ",(0,i.kt)("a",{parentName:"li",href:"#baseurl-112p220401"},"Setting the Base URL"))),(0,i.kt)("h3",{id:"upgrade-from-103d01"},"Upgrade from 1.0.3D0.1"),(0,i.kt)("p",null,"To upgrade from a previouse version to this release, a few manual steps have to be done. In the new release, we changed to make use of Docker volumes instead of bind mounts for all user data and shared storages. It is up to the user to transfer previous user data to these volumes.\nAll you need to do is to copy/merge your old folders to/with the data volume (mounted at ",(0,i.kt)("inlineCode",{parentName:"p"},"/chemotion/data")," in the ELN container):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"./shared/eln/uploads")," --\x3e ",(0,i.kt)("inlineCode",{parentName:"li"},"/chemotion/data/uploads")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"./shared/eln/public/images")," --\x3e ",(0,i.kt)("inlineCode",{parentName:"li"},"/chemotion/data/public/images"))),(0,i.kt)("p",null,"We recommend the following steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Bring down your current instance, backup everything:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose down --remove-orphans\nsudo tar cvzf /tmp/pre-upgrade.tar.gz ./db-data ./shared ./docker-compose.yml\n")),(0,i.kt)("p",null,"In case anything goes wrong, you can always fall back to this backup by simply extracting the archive."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"clean your directory, since the new containers will also write to ",(0,i.kt)("inlineCode",{parentName:"li"},"./shared")," ")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"rm docker-compose.yml\nsudo mv ./shared ./old\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"download the ",(0,i.kt)("inlineCode",{parentName:"li"},"docker-compose.yml"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"wget https://raw.githubusercontent.com/ptrxyz/chemotion/main/new-build/release/1.1.2p220401/docker-compose.yml\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"download all images and create the containers, data volumes and networks by running this command in the same folder you downloaded the compose file to:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose create\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"start a disposable sidecar container with an interactive shell attaching your old data and old db stores in addition to the storages defined in ",(0,i.kt)("inlineCode",{parentName:"li"},"docker-compose.yml"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker run -v $(pwd)/old:/old \\\n           -v chemotion_data:/new \\\n           -v $(pwd)/db-data:/old/db \\\n           -v chemotion_db:/new/db \\\n           -it --rm ubuntu:latest bash\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You will find yourself in the root of a fresh container. Copy over the following files:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"cp -Rf /old/eln/uploads/.        /new/uploads/\ncp -Rf /old/eln/public/images/.  /new/public/images/\ncp -Rf /old/db/.                 /new/db/\n")),(0,i.kt)("p",null,"Note: the point here is that you copy everything from your old ",(0,i.kt)("inlineCode",{parentName:"p"},"uploads")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"public/images")," folder to the new location. By default those are stored in ",(0,i.kt)("inlineCode",{parentName:"p"},"./eln/"),", if you configured things differently, adjust accordingly."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Your data is now stored on the data volumes. Type ",(0,i.kt)("inlineCode",{parentName:"li"},"exit")," to quit the interactive shell."),(0,i.kt)("li",{parentName:"ul"},"start your new instances:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose up\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"after a short startup/migration period, the ELN will available on port ",(0,i.kt)("inlineCode",{parentName:"li"},"<your host IP>:4000")),(0,i.kt)("li",{parentName:"ul"},"Proceed with the sections ",(0,i.kt)("a",{parentName:"li",href:"#config-112p220401"},"Configuring")," and ",(0,i.kt)("a",{parentName:"li",href:"#baseurl-112p220401"},"Setting the Base URL"))),(0,i.kt)("h3",{id:"config-112p220401"},"Configuring"),(0,i.kt)("p",null,"To keep your new installation clean, we switched to an overlay-based configuration system. The ELN instance will from now on start with (reasonable) defaults and overlay all files found in ",(0,i.kt)("inlineCode",{parentName:"p"},"./shared/pullin/")," onto the ELN application directory. As an example, to configure a ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file, it's filename would be ",(0,i.kt)("inlineCode",{parentName:"p"},"./shared/pullin/.env"),". Files you might want to configure:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},".env")," --\x3e ",(0,i.kt)("inlineCode",{parentName:"li"},"./shared/pullin/.env")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"database.yml")," --\x3e ",(0,i.kt)("inlineCode",{parentName:"li"},"./shared/pullin/config/database.yml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"editors.yml")," --\x3e ",(0,i.kt)("inlineCode",{parentName:"li"},"./shared/pullin/config/editors.yml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"welcome-message.md")," --\x3e ",(0,i.kt)("inlineCode",{parentName:"li"},"./shared/pullin/public/welcome-message.md")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"editors"),"-folder --\x3e ",(0,i.kt)("inlineCode",{parentName:"li"},"./shared/pullin/public/editors"))),(0,i.kt)("p",null,"Have a look at the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ComPlat/chemotion_ELN"},"Complat/Chemotion-GitHub-Repo")," to get an overview where things need to be placed."),(0,i.kt)("h3",{id:"baseurl-112p220401"},"Setting the Base-URL"),(0,i.kt)("p",null,"Please make sure you configure .env to contain at least two settings:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"URL_HOST=<your domain here>:<port>\nURL_PROTOCOL=<http or https>\n")),(0,i.kt)("p",null,"Since Chemotion sends out links that point to the ELN, it needs to know where the ELN is running. So configure those two variables to make sure the ELN can construct the URLs properly. An example for ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," would look like this:"),(0,i.kt)("p",null,"(",(0,i.kt)("em",{parentName:"p"},"./shared/pullin/.env"),":)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"URL_HOST=localhost:4000\nURL_PROTOCOL=http\n")),(0,i.kt)("p",null,"Of course, if you are using default ports for your protocol (80 or 443) you can omit the ",(0,i.kt)("inlineCode",{parentName:"p"},":<port>")," part and simply use ",(0,i.kt)("inlineCode",{parentName:"p"},"URL_HOST=localhost")," for example. "),(0,i.kt)("p",null,"Note: Settings protocol to ",(0,i.kt)("inlineCode",{parentName:"p"},"https")," requires you to configure TLS on your machine (i.e. with a HTTP proxy like NGINX). It will NOT magically make it work for you. Those settings are simply used to construct URLs."),(0,i.kt)("h3",{id:"other-documentation"},"Other Documentation"),(0,i.kt)("p",null,"The new version comes with some quality-of-life changes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"to check the logs of a service, use either ",(0,i.kt)("inlineCode",{parentName:"li"},"docker-compose logs")," or check the ",(0,i.kt)("inlineCode",{parentName:"li"},"./shared/logs")," folder."),(0,i.kt)("li",{parentName:"ul"},"to create a backup of your data, you can use the embedded Chemotion CLI tools:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose exec eln chemotion backup\n")),(0,i.kt)("p",null,"This will create a backup in ./shared/backup/"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"to restore a backup, clean out your Compose-directory, keep only the backup folder and it's files in place.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose down --remove-orphans       # stop all services\ndocker-compose run eln chemotion restore   # restore the latest backup\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Resetting the Administrator account's password:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose exec eln chemotion resetAdminPW\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Getting a Rails console:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose exec eln chemotion railsc\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Getting a shell with loaded Chemotion environment variables:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose exec eln chemotion shell\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Drop to Postgres console in the Chemotion database:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose exec eln chemotion psql\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Display basic version information:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose exec eln chemotion info\n")),(0,i.kt)("h4",{id:"notes-on-backups"},"Notes on Backups:"),(0,i.kt)("p",null,"The backup script is meant to simplify your life a bit when it comes to backups. However it doesn't do anything magical and if it suits your needs better, you can also do manual backups. To create on, you need to dump your database, i.e. with ",(0,i.kt)("inlineCode",{parentName:"p"},"pg_dump")," or by copying the ",(0,i.kt)("inlineCode",{parentName:"p"},"chemotion_db")," volume when the database is not running.\nIn addition, you need to safe all your data, that is two folders: ",(0,i.kt)("inlineCode",{parentName:"p"},"/uploads")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"/public/images")," (the latter being more a convenience thing preventing you from having to recreate a lots of thumbnails after restoration). The data is stored on the ",(0,i.kt)("inlineCode",{parentName:"p"},"chemotion_data")," volume, so you can simply mount it somewhere and use rsync/tar/cp to copy the data. If you already have a container mounting this volume, such as (such as the ",(0,i.kt)("inlineCode",{parentName:"p"},"eln")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"worker")," services), you can also simply use ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose cp")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"docker cp")," to copy the data to the host machine and do anything you like with it."),(0,i.kt)("p",null,"To restore a backup, invert the process: While backups can be done with running services, for restoration, you need to stop your services, then playback the SQL-dump (pg_restore/psql/copy the volume or data files back) and then playback the data using cp/tar/rsync/etc."),(0,i.kt)("h2",{id:"version-103d01"},"Version 1.0.3D0.1"),(0,i.kt)("p",null,"With release ",(0,i.kt)("inlineCode",{parentName:"p"},"1.0.3D0.1"),", beside upgrading the ELN version to 1.0.3, we made great improvements to the Docker middleware framework. We introduce the concept of ",(0,i.kt)("em",{parentName:"p"},"configuration landscapes")," as bundles of configuration files that describe a certain environment. This is a first step to enabling users to easily switch between production, testing or teaching environments with a single command."),(0,i.kt)("p",null,"As of now, there is only one landscape shipped with the image and we plan to add more over time depending on user needs. You can always create your own landscapes and quickly move between them. Check out the ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose run eln landscape")," command for more info."),(0,i.kt)("p",null,"Further, this changed the config file structure a bit. While in previous versions, the ELN configuration was stored in ",(0,i.kt)("inlineCode",{parentName:"p"},"./shared/config")," and the container configuration was stored in ",(0,i.kt)("inlineCode",{parentName:"p"},"./config"),", there is only one folder now: ",(0,i.kt)("inlineCode",{parentName:"p"},"./shared"),". We hope this change makes it more intuitive for users."),(0,i.kt)("p",null,"On the inside, we managed to reduce the size of our images by more than 50% by being more selective when it comes to installed packages: using multistage builds to build the big dependencies makes sure that no build artifacts are unnecessarily present in the final image. To ensure consistency we added a dependency scanner that makes sure that all dependencies are still satisfied and no libraries are missing."),(0,i.kt)("h2",{id:"preparation"},"Preparation"),(0,i.kt)("p",null,"To setup the Chemotion ELN using Docker, Docker and Docker-Compose have to be installed on the host machine. Please refer to your distributions documentation on how this can be achieved. For Ubuntu-based machines, this can be found ",(0,i.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/ubuntu/"},"here"),"."),(0,i.kt)("p",null,"In addition you need that latest version of our Docker-Compose service description as well as some scripts depending on your scenario. The file can be found here:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"File"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"https://github.com/ptrxyz/chemotion/blob/main/client-chemotion/docker-compose.yml"},"docker-compose.yml")),(0,i.kt)("td",{parentName:"tr",align:null},"service description file")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"https://raw.githubusercontent.com/ptrxyz/chemotion/v1.0.3D0.1/client-chemotion/setup.sh"},"setup.sh")),(0,i.kt)("td",{parentName:"tr",align:null},"use this script if you plan to setup a new Chemotion ELN instance")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"https://raw.githubusercontent.com/ptrxyz/chemotion/v1.0.3D0.1/client-chemotion/upgrade.sh"},"upgrade.sh")),(0,i.kt)("td",{parentName:"tr",align:null},"this script shall be used to perform an upgrade of an existing instance from v0.9.1 to v1.0.3")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("a",{parentName:"td",href:"https://raw.githubusercontent.com/ptrxyz/chemotion/v1.0.3D0.1/client-chemotion/backup.sh"},"backup.sh")),(0,i.kt)("td",{parentName:"tr",align:null},"script to backup your data before messing things up")))),(0,i.kt)("p",null,"(For other releases, check out our repository on DockerHub",(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," and the archived installation on Github",(0,i.kt)("sup",{parentName:"p",id:"fnref-2"},(0,i.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2")),")\n",(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),": Chemotion-Images hosted on ",(0,i.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/ptrxyz/chemotion/tags?ordering=last_updated"},"DockerHub"),"\n",(0,i.kt)("sup",{parentName:"p",id:"fnref-2"},(0,i.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2")),": Archived Documentation on ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ComPlat/chemotion_saurus/blob/026531e75ced4f31ec2da3884e2a9a450e949192/docs/eln/docker-installation.md"},"Github")),(0,i.kt)("p",null,"Download this file and place it in a separate folder (further referred to as ",(0,i.kt)("inlineCode",{parentName:"p"},"CHEMOTION_PATH")," as it will contain all the service description but also Chemotion's configuration and data files):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"mkdir -p $CHEMOTION_PATH\ncd $CHEMOTION_PATH\ncurl -L -O https://raw.githubusercontent.com/ptrxyz/chemotion/v1.0.3D0.1/client-chemotion/docker-compose.yml\ncurl -L -O https://raw.githubusercontent.com/ptrxyz/chemotion/v1.0.3D0.1/client-chemotion/backup.sh\ncurl -L -O https://raw.githubusercontent.com/ptrxyz/chemotion/v1.0.3D0.1/client-chemotion/setup.sh\ncurl -L -O https://raw.githubusercontent.com/ptrxyz/chemotion/v1.0.3D0.1/client-chemotion/upgrade.sh\n")),(0,i.kt)("p",null,"As a next step, run the setup script and follow the instructions:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"cd $CHEMOTION_PATH\nbash ./setup.sh\n")),(0,i.kt)("h2",{id:"running-chemotion"},"Running Chemotion"),(0,i.kt)("p",null,"You are now ready to run the initialization. Please note that this will create a new database and delete any old database that might exist. Therefore it is curical that you do only run this command if you want to create a new instance of Chemotion."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"cd $CHEMOTION_PATH\ndocker-compose run eln landscape deploy\ndocker-compose run eln init\n")),(0,i.kt)("p",null,"As the previous command finishes, you are ready to start Chemotion:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose up\n")),(0,i.kt)("p",null,"You will see the system logs in your terminal and after the start-up you can access your fresh instance using a browser. The application is running on ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:4000"),", the seeded administration account is ",(0,i.kt)("inlineCode",{parentName:"p"},"ADM")," (all caps!) with password ",(0,i.kt)("inlineCode",{parentName:"p"},"PleaseChangeYourPassword"),"."),(0,i.kt)("p",null,"To start your instance in background mode, use ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose up -d"),".\nThe services will automatically restart when the docker daemon restarts. This can be configured by removing the lines containing ",(0,i.kt)("inlineCode",{parentName:"p"},"restart: unless-stopped")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file or disabling autostart of your docker daemon on your system:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-docker-compose.yml"},"services:\n  db:\n    ...\n  worker:\n    restart: unless-stopped\n    ...    \n  eln:\n    restart: unless-stopped\n    ...   \n")),(0,i.kt)("p",null,"Please refer to the Docker documentation on how this property works: ",(0,i.kt)("a",{parentName:"p",href:"https://docs.docker.com/config/containers/start-containers-automatically/"},"https://docs.docker.com/config/containers/start-containers-automatically/")),(0,i.kt)("h2",{id:"managing-your-instance"},"Managing your instance"),(0,i.kt)("h3",{id:"basic-information"},"Basic Information"),(0,i.kt)("p",null,"To get basic information about your instance, run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose run eln info\n")),(0,i.kt)("p",null,"This will output storage, memory as well as several version information and ensure the fundamentally required runtime is correct."),(0,i.kt)("h3",{id:"getting-a-shell-inside-the-container"},"Getting a shell inside the container"),(0,i.kt)("p",null,"To get access to the inside of the container, i.e to perform tasks based on the Rails console, one can use the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose run eln shell\n")),(0,i.kt)("p",null,"This will drop you to a root shell inside the container. You are now free to perform any administrative tasks in the container context, but be aware that all changes are ephemeral and lost when the container is stopped. To access the host file system, a mount point has to be used, i.e. such as the already configured ",(0,i.kt)("inlineCode",{parentName:"p"},"/shared")," (which - by default - maps to ",(0,i.kt)("inlineCode",{parentName:"p"},"./shared")," on the host)."),(0,i.kt)("h2",{id:"backing-up-your-data"},"Backing up your data"),(0,i.kt)("p",null,"To backup your data, it is sufficient to run the following command on your host machine (not inside the container) in the folder, where your Compose file resides:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo bash ./backup.sh\n")),(0,i.kt)("p",null," :::info\nIt is adviced to setup an automatic system task (i.e. cron job) to backup regularly. This is highly system specific and thus out of the scope of this documentation. Please refer to your OS's manual to find out how to setup scheduled tasks.\nIn addition, you should always backup before upgrading your installation.\n:::"),(0,i.kt)("h2",{id:"upgrading"},"Upgrading"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: Before upgrading anything, we highly advice to create a backup (see above)! No backup? no pity!\nNote: This upgrade is tailored and tested for the upgrade from 0.9.1 to 1.0.3.\nNote: downgrading is not supported.")),(0,i.kt)("p",null,"Stop the services: ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose stop --remove-orphans")),(0,i.kt)("p",null,"To upgrade your instance place the new ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"upgrade.sh")," in the directory where the Chemotion service files reside and run"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo bash ./upgrade.sh\n")),(0,i.kt)("p",null,"This will make sure files are properly configured and the database schemes are adjusted if necessary."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: Without this step, the containers will refuse to start to prevent any possible damage to your installation.")),(0,i.kt)("p",null,"Now, restart the services: ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose restart")),(0,i.kt)("h3",{id:"setting-up-a-reverse-proxy"},"Setting up a Reverse-Proxy"),(0,i.kt)("p",null,"To make the installation available to the public, the container's ports should to be forwarded. We suggest to run NGINX as a reverse-proxy either in docker (by extending the Docker-Compose service description file) or stand-alone on the host. The application is (by default) listening on '0.0.0.0:4000'."),(0,i.kt)("p",null,"A demo service description as well as some sample configuration files for NGINX can be found in the Docker-Chemotion-Monorepo (",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ptrxyz/chemotion"},"https://github.com/ptrxyz/chemotion"),") in the sub-folder ",(0,i.kt)("inlineCode",{parentName:"p"},"reverse-proxy"),"."))}u.isMDXComponent=!0}}]);