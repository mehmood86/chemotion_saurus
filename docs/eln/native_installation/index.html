<!doctype html>
<html class="docs-version-1.1.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/chemotionsaurus/blog/rss.xml" title="Chemotion RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/chemotionsaurus/blog/atom.xml" title="Chemotion Atom Feed"><title data-react-helmet="true">Native Installation | Chemotion</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://chemotion.net/chemotionsaurus/docs/eln/native_installation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="1.1.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-1.1.1"><meta data-react-helmet="true" property="og:title" content="Native Installation | Chemotion"><meta data-react-helmet="true" name="description" content="Documentation and processes are being reworked and improved at the moment. It may happen that you miss information. If you face problems, please let us know, we are there to support you. You may contact the helpdesk about chemotion ELN or submit a request directly if you plan to install or test Chemotion."><meta data-react-helmet="true" property="og:description" content="Documentation and processes are being reworked and improved at the moment. It may happen that you miss information. If you face problems, please let us know, we are there to support you. You may contact the helpdesk about chemotion ELN or submit a request directly if you plan to install or test Chemotion."><link data-react-helmet="true" rel="icon" href="/chemotionsaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chemotion.net/chemotionsaurus/docs/eln/native_installation"><link data-react-helmet="true" rel="alternate" href="https://chemotion.net/chemotionsaurus/docs/eln/native_installation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chemotion.net/chemotionsaurus/docs/eln/native_installation" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://undefined-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/chemotionsaurus/assets/css/styles.962639bc.css">
<link rel="preload" href="/chemotionsaurus/assets/js/runtime~main.cd4bfac8.js" as="script">
<link rel="preload" href="/chemotionsaurus/assets/js/main.63004e89.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/chemotionsaurus/"><div class="navbar__logo"><img src="/chemotionsaurus/img/favicon.ico" alt="Chemotion" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/chemotionsaurus/img/favicon.ico" alt="Chemotion" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Chemotion</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/chemotionsaurus/docs/eln/intro">ELN</a></li><li><a class="dropdown__link" href="/chemotionsaurus/docs/repo/videos_repo">Repository</a></li><li><a class="dropdown__link" href="/chemotionsaurus/docs/docu/Set Up">About this documentation</a></li></ul></div><a class="navbar__item navbar__link" href="/chemotionsaurus/blog/newsroom">Newsroom</a></div><div class="navbar__items navbar__items--right"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search Documentation"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search Documentation</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/chemotionsaurus/docs/category/installation">ELN</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/chemotionsaurus/docs/category/installation">Installation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/chemotionsaurus/docs/eln/native_installation">Production</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/chemotionsaurus/docs/eln/native_installation">Native installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/docker_installation">Docker installation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" tabindex="0" href="/chemotionsaurus/docs/eln/development_native_installation">Development</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/chemotionsaurus/docs/category/development">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/chemotionsaurus/docs/category/configuration">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/chemotionsaurus/docs/category/manual">Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/chemotionsaurus/docs/category/admin-ui">Admin UI</a><button aria-label="Toggle the collapsible sidebar category &#x27;Admin UI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/chemotionsaurus/docs/category/device-integration">Device integration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Device integration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/faq_eln">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/specific_contact">Contact</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->1.1.1</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Native Installation</h1></header><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Documentation and processes are being reworked and improved at the moment. It may happen that you miss information. If you face problems, please let us know, we are there to support you. You may contact the <a href="https://helpdesk.nfdi4chem.de" target="_blank" rel="noopener noreferrer">helpdesk</a> about chemotion ELN or submit a <a href="https://www.nfdi4chem.de/index.php/setup-own-eln/" target="_blank" rel="noopener noreferrer">request</a> directly if you plan to install or test Chemotion. </p></div></div><p>This documentation detailled an installation solution example of the the chemotion_ELN system and associated services on Ubuntu servers with NGINX as web server and Phusion-passenger as app server.</p><p>The chemotion_ELN is a web-application that needs the following elements:</p><ul><li>web-server and application server: NGINX with Passenger-phusion</li><li>DB: postgresql (&gt;10)</li><li>the web application itself</li><li>worker-applications to execute background tasks</li><li>disk space to store attachment files from the users</li></ul><p>The code for the web-application (server- and client- sides) and the workers is what we provide.</p><p>For a few users, all this components can be installed on a single machine (2 cpu s, 4GB memory) using the <a href="https://github.com/ComPlat/chemotion_ELN/blob/development-5/scripts/install_production.sh" target="_blank" rel="noopener noreferrer">installation script</a> that will set up all these components and basic configurations.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p> Use a sudo user, not root, to run the script! </p></div></div><p><img alt="architecture_ELN" src="/chemotionsaurus/assets/images/architecture_ELN_base-099e78fdeac84452afa5cdaeaf0c31a5.svg" width="283" height="592"></p><p>In short the installation, will:</p><ul><li>install OS package dependencies</li><li>install passenger</li><li>create a new user</li><li>install ruby and nodejs for this user</li><li>create a postgresql DB</li><li>copy the chemotion_ELN code and prepare basic config files</li><li>do a capistrano app deploy</li><li>config nginx (NB: no ssl set) and UFW</li></ul><p>For more users, one can start to split the services onto distinct machines.</p><p><img alt="architecture_ELN_dist" src="/chemotionsaurus/assets/images/architecture_ELN_dist-c6c03e6f2158d7d131566eae05be0a55.svg" width="903" height="1063"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="hardware-requirement">Hardware Requirement<a class="hash-link" href="#hardware-requirement" title="Direct link to heading">​</a></h2><p>To install on a single machine for few users below is the minimum hardware requirement.</p><ul><li>4GB RAM</li><li>Dual Core</li><li>50-100GB hard disk </li><li>Ubuntu 20.04 LTS</li></ul><p>For multiple machine configuration and splitting the services onto different machines below is the hardware requirement:</p><p><strong>ELN web and worker server</strong>:</p><ul><li>3GB RAM</li><li>Dual Core</li><li>10-20GB hard disk</li><li>Ubuntu 20.04 LTS</li></ul><p><strong>DB server</strong>:</p><ul><li>2GB RAM</li><li>Dual Core</li><li>500GB hard disk or smaller (depending upon the size of the metadata)</li><li>Ubuntu 20.04 LTS</li></ul><p><strong>ELN proxy server</strong>:</p><ul><li>2GB RAM</li><li>Dual Core</li><li>8GB hard disk</li><li>Ubuntu 20.04 LTS</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="nginx---phusion-passenger">Nginx - Phusion passenger<a class="hash-link" href="#nginx---phusion-passenger" title="Direct link to heading">​</a></h2><p>More info on NGINX open source can be found on <a href="http://nginx.org/en/docs/" target="_blank" rel="noopener noreferrer">nginx.org</a>. For Phusion Passenger, see <a href="https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/nginx/install/" target="_blank" rel="noopener noreferrer">phusionpassenger.com</a>.</p><p>The configuration files are at /etc/nginx/sites-enabled/ (symlinked from ../sites-available).
SSL use is recommended and should be set there.</p><p>To help with building the ssl config, one can use the <a href="https://ssl-config.mozilla.org/" target="_blank" rel="noopener noreferrer">configurator from Mozilla</a></p><p>Copy or edit your currently enabled config (/etc/nginx/sites-available/...) to change the listening port from 80 to 443 and set the path to the certificates for an example to:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        listen 443 ssl http2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        listen [::]:443 ssl http2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># SSL config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ssl_certificate /path/to/signed_cert_plus_intermediates;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ssl_certificate_key /path/to/private_key;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        # ssl_trusted_certificate /path/to/interm;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ssl_session_timeout 1d;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ssl_session_cache shared:MozSSL:1m;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       ssl_protocols TLSv1.2 TLSv1.3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       ssl_prefer_server_ciphers off;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       # HSTS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       add_header Strict-Transport-Security &quot;max-age=63072000&quot; always;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .....</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>One can also add  a DH group:</p><p>generate the group with  <code>sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 4096</code></p><p>then add it to the nginx server config</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ssl_dhparam /etc/ssl/certs/dhparam.pem;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>the rest of the config should be unchanged and similar to:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">......</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># application</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        passenger_enabled on;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        client_max_body_size xxm;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        passenger_ruby /home/production/.rvm/wrappers/ruby-x.x.x/ruby;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        root /var/www/chemotion_ELN/current/public;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        server_name _;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        # server_name www.my-eln.tld my-eln.tld;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            proxy_pass http://127.0.0.1:xxxx;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            proxy_set_header Host $http_host;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            proxy_set_header Connection &quot;upgrade&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            proxy_buffering off;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>force ssl redirection from port 80 to 443</strong>:
With a sudo user, create a file  in  sites-available/. and enable it by linking it into sites-enabled/.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  listen 80;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  listen [::]:80;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server_name your_server_name;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  return      301  https://$server_name$request_uri ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>test the config (<code>sudo nginx -t -c /etc/nginx/nginx.conf</code>)  and restart/reload nginx (<code>sudo systemctl restart nginx </code>)</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="application-file--directory-structure">Application File &amp; Directory Structure<a class="hash-link" href="#application-file--directory-structure" title="Direct link to heading">​</a></h2><p>With this setup the application code is located at /var/www/chemotion/ELN/current
The installation script calls <a href="https://capistranorb.com/documentation/overview/what-is-capistrano/" target="_blank" rel="noopener noreferrer">Capistrano</a> to deploy the Rails app. Because of that, the structure of application files is the following:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/www/chemotion_ELN/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── current -&gt; /var/www/chemotion_ELN/releases/202101XXXXXXXX</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── releases</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   ├── 202101XXXXXXXX</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   ├── 202101XXXXXXXX</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   └─── 202101XXXXXXXX</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── app</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── deploy_backup -&gt; /var/www/chemotion_ELN/shared/backup/deploy_backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── models</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   └── weekly_backup -&gt; /var/www/chemotion_ELN/shared/backup/weekly_backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── bin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── data_collector_keys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── deploy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── environments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── initializers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── locales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   └── unicorn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── db</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── functions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── migrate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── seeds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── triggers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   └── views</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── lib</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── log -&gt; /var/www/chemotion_ELN/shared/log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── node_modules -&gt; /var/www/chemotion_ELN/shared/node_modules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── public</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── assets -&gt; /var/www/chemotion_ELN/shared/public/assets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── images -&gt; /var/www/chemotion_ELN/shared/public/images</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── simulations -&gt; /var/www/chemotion_ELN/shared/public/simulations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   └── zip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── tmp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── cache -&gt; /var/www/chemotion_ELN/shared/tmp/cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── novnc_devices -&gt; /var/www/chemotion_ELN/shared/tmp/novnc_devices</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── pids -&gt; /var/www/chemotion_ELN/shared/tmp/pids</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ├── sockets -&gt; /var/www/chemotion_ELN/shared/tmp/sockets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   └── uploads -&gt; /var/www/chemotion_ELN/shared/tmp/uploads</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── uploads -&gt; /var/www/chemotion_ELN/shared/uploads</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       └── vendor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│           └── assets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── repo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   ├── branches</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   ├── ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── refs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── .. heads</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       └ ..</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└── shared</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── .env</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── deploy_backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   └── weekly_backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── database.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   └── storage.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── node_modules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├─ ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── public</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── assets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── ...ketcherails</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── images</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── ghs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── images</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── ketcherails</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── molecules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── qr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── reactions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── research_plans</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── samples</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── sprites</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── templates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   ├── thumbnail</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   │   └── wild_card</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── ontologies</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── simulations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   └</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── tmp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── novnc_devices</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── pids</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ├── sockets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   └── uploads</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    └── uploads</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Configuration files for the application are in the <em>config</em> directory.
In the currently running application directory the configuration files ( <em>current/config/*.yml</em> ) are linked from <em>shared/config/*yml</em></p><p>The web and background-worker applications are started a reboot by executing the script /home/production/boot-ELN.sh from the crontab.
The ruby dependencies and node versions are also in the home directory.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/home/production</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── .nvm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── .rvm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── Backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└── boot-ELN.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="file-storage">File storage<a class="hash-link" href="#file-storage" title="Direct link to heading">​</a></h3><p>Files uploaded by the users are stored in /var/www/chemotion_ELN/shared/uploads.
The path is defined in the storage.yml config.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="db-settings">DB settings<a class="hash-link" href="#db-settings" title="Direct link to heading">​</a></h3><p>Connection to the DB is set in <em>config/database.yml</em>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="multiple-machine-configuration">Multiple Machine Configuration<a class="hash-link" href="#multiple-machine-configuration" title="Direct link to heading">​</a></h2><p>When splitting the tasks on several machines make sure you meet the above <a href="#hardware-requirement">hardware requirement</a>. There should also be a shared directory among all the VMs and should have access for read and write. Following are the files which needs to be accessible to any web-app or worker-app instance</p><ul><li>DB</li><li>uploaded user files</li><li>images</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="db-setup">DB Setup:<a class="hash-link" href="#db-setup" title="Direct link to heading">​</a></h3><p>Chemotion runs on PostgreSQL relational database (version &gt;10).In order to setup DB server we have to install PostgreSQL and create necessary role,DB and extension.
Follow below steps to setup the DB server.</p><p>1.Install Postgres</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt-get -y install postgresql-12</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="2"><li>To check if postgres is correctly installed. Run below command to check the version and status.</li></ol><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apt show postgresql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service postgresql status</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="3"><li><p>Allow remote connection to postgres.To help doing this you can follow <a href="https://www.thegeekstuff.com/2014/02/enable-remote-postgresql-connection/" target="_blank" rel="noopener noreferrer">link here</a></p></li><li><p>Create DB, Role and Extension</p><p><em>NOTE: Perform this step after Step 3 of ELN Web App Setup.</em></p><ul><li>Create Role:</li></ul><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo -u postgres psql -c &quot; CREATE ROLE $DB_ROLE LOGIN CREATEDB NOSUPERUSER PASSWORD &#x27;$DB_PW&#x27;;&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>Create DB:</li></ul><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo -u postgres psql -c &quot; CREATE DATABASE $DB_NAME OWNER $DB_ROLE;&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>Create Extension:</li></ul><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo -u postgres psql -d $DB_NAME -c &#x27; CREATE EXTENSION IF NOT EXISTS &quot;pg_trgm&quot;; CREATE EXTENSION IF NOT EXISTS &quot;hstore&quot;;  CREATE EXTENSION IF NOT EXISTS &quot;uuid-ossp&quot;;&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><em>NOTE : replace $DB_NAME, $DB_PW and $DB_ROLE by the values  saved in .env file of app_server (/var/www/chemotion_ELN/shared/.env)</em></p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="eln-web-app-setup">ELN Web App Setup:<a class="hash-link" href="#eln-web-app-setup" title="Direct link to heading">​</a></h3><p>Follow the below steps to install the ELN application.</p><ol><li><p>Copy the installation script on an Ubuntu server 20.04 LTS</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -o chemotion_ELN_install.sh -L https://raw.githubusercontent.com/ComPlat/chemotion_ELN/development/scripts/install_production.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Check the variables at the beginning of the file, but also check the whole script to see what it is doing.
This will basically install evrything on one machine but configuration within can be reworked to just serve one purpose.
The script will...</p><ul><li>install OS package dependencies</li><li>install passenger</li><li>create a new user</li><li>install ruby and nodejs for the user</li><li>create a postgresql DB</li><li>copy the chemotion_ELN code and prepare basic config files</li><li>do a capistrano app deploy</li><li>config nginx (NB: no ssl set) and UFW</li></ul><p>You can also comment out the part from script which you want to skip during the installation.</p></li><li><p>When ready, make the script executable and run it as a non-root user (but in the sudo group):</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod 700 chemotion_ELN_install.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ./chemotion_ELN_install.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The whole installation process may take approximately an hour to complete. Once done the system should reboot and the application should be up and running at the
IP of the   machine   (http://...). An admin account should have been created (email: <a href="mailto:eln-admin@kit.edu" target="_blank" rel="noopener noreferrer">eln-admin@kit.edu</a>, pw: PleaseChangeYourPassword)</p></li><li><p>Connect to remote DB server by updating the HOST and PORT in database.yml file (<em>/var/www/chemotion_ELN/shared/config/database.yml</em>) or instead update the parameter at
.env file (<em>/var/www/chemotion_ELN/shared/.env</em>). </p></li><li><p>Once connection is succesfully established follow step 4 of DB Setup to Create DB,Role and Extension.</p></li><li><p>After sucessfully completing the DB configuration migrate the DB and restart the app by running below command in app server as production user.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo su production</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">source ~/.profile &amp;&amp; cd /var/www/chemotion_ELN/current &amp;&amp; RAILS_ENV=production bundle exec rake db:migrate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">touch /var/www/chemotion_ELN/current/tmp/restart.txt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Once the application is setup, technically we can uninstall the postgres and stop the worker job from this server.</p></li><li><p>To uninstall PostgreSQL from the app server you can follow the <a href="https://askubuntu.com/questions/32730/how-to-remove-postgres-from-my-installation" target="_blank" rel="noopener noreferrer">link here</a></p></li><li><p>The worker app (<em>delayed_job</em>) and  the web app (<em>passenger instance</em>) are  started at machine-reboot  through crontab of the production user.
Crontab will execute at reboot a script located  at <em>/home/production/boot-ELN.sh</em>. In order to stop the worker job, comment out the job on the script
section (<em>/home/production/boot-ELN.sh</em>) and quit the job(<em>delayed_job</em>) from the process manager as well(<em>htop</em>).</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="eln-web-worker-setup">ELN Web Worker Setup:<a class="hash-link" href="#eln-web-worker-setup" title="Direct link to heading">​</a></h3><p>Follow the below steps to configure the worker.</p><ol><li>Download and execute the installation script as done in Step 1 of app setup. This time you can execute the script by
commenting out the Part 2,6,71 and 11. <div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_0=&#x27;update OS&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_1=&#x27;deb dependencies installation&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_1_1=&#x27;deb specific dep version&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#PART_2=&#x27;nginx and phusionpassenger installation&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_3=&#x27;create a ubuntu user&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_4=&#x27;rvm and ruby installation&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_5=&#x27;nvm and npm installation&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#PART_6=&#x27;prepare postgresql DB&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_7=&#x27;prepare production app directories and config&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#PART_71=&#x27;reset DB pw&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_8=&#x27;prepare first deploy and deploy application code&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_81=&#x27;seed common ketcher templates&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_82=&#x27;seed common reagents&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_9=&#x27;prepare boot start and log rotation&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PART_10=&#x27;configure UFW&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#PART_11=&#x27;configure NGINX&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li>Once installation done succesfully you can configure the DB server at .env file (<em>/var/www/chemotion_ELN/shared/.env</em>).</li><li>To check if installation was successful login as production user and perform below action.<div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">source ~/.profile &amp;&amp; cd /var/www/chemotion_ELN/current &amp;&amp; RAILS_ENV=production bundle exec rails c#then run some ruby rails command:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Person.count</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li>You can edit the boot-ELN.sh to only reboot the worker. Now that your worker and app setup is done make sure below files are shared between the VMs
and have read and write permissions.<ul><li>to share btw VMs:</li></ul><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/www/chemotion_ELN/shared/uploads/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/www/chemotion_ELN/shared/public/images/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/www/chemotion_ELN/shared/tmp/uploads/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/www/chemotion_ELN/shared/public/zip/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>to share or duplicate:</li></ul><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/www/chemotion_ELN/shared/config/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/www/chemotion_ELN/shared/.env</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="eln-web-proxy-setup">ELN Web Proxy Setup:<a class="hash-link" href="#eln-web-proxy-setup" title="Direct link to heading">​</a></h3><ol><li><p>Install Nginx </p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt-get install nginx</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>If you don&#x27;t have a certificate already, you can grab one for free at <a href="https://certbot.eff.org/" target="_blank" rel="noopener noreferrer">Let&#x27;s Encrypt</a></p></li><li><p>Edit default config file in <em>/etc/nginx/sites-available/default</em> and proxy pass to your app server. You can refer below configuration for reference.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">....</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    listen [::]:443 ssl ipv6only=on; # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    listen 443 ssl; # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #SSL Certificate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssl_certificate __path_to_certificate__; # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssl_certificate_key __path_to_certificate_key__; # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             # Add index.php to the list if you are using PHP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             index index.html index.htm index.nginx-debian.html;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             server_name your_domain; # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             location / {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     proxy_pass http://(_your_app_domain_):8080;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     proxy_http_version 1.1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     proxy_set_header Connection &quot;upgrade&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     proxy_set_header Host $http_host;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     proxy_set_header X-Nginx-Proxy true;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     proxy_redirect off;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       } </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             if ($host = application.chemotion.uni-jena.de) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     return 301 https://$host$request_uri;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             } # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             listen 80 ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             listen [::]:80 ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             server_name _your_domain_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             return 404; # managed by Certbot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">....</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ComPlat/chemotion_saurus/edit/master/versioned_docs/version-1.1.1/eln/native_installation.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-04-20T18:08:17.000Z">4/20/2022</time></b> by <b>Danny Truong</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/chemotionsaurus/docs/category/installation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Installation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/chemotionsaurus/docs/eln/docker_installation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Docker installation</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hardware-requirement" class="table-of-contents__link toc-highlight">Hardware Requirement</a></li><li><a href="#nginx---phusion-passenger" class="table-of-contents__link toc-highlight">Nginx - Phusion passenger</a></li><li><a href="#application-file--directory-structure" class="table-of-contents__link toc-highlight">Application File &amp; Directory Structure</a><ul><li><a href="#file-storage" class="table-of-contents__link toc-highlight">File storage</a></li><li><a href="#db-settings" class="table-of-contents__link toc-highlight">DB settings</a></li></ul></li><li><a href="#multiple-machine-configuration" class="table-of-contents__link toc-highlight">Multiple Machine Configuration</a><ul><li><a href="#db-setup" class="table-of-contents__link toc-highlight">DB Setup:</a></li><li><a href="#eln-web-app-setup" class="table-of-contents__link toc-highlight">ELN Web App Setup:</a></li><li><a href="#eln-web-worker-setup" class="table-of-contents__link toc-highlight">ELN Web Worker Setup:</a></li><li><a href="#eln-web-proxy-setup" class="table-of-contents__link toc-highlight">ELN Web Proxy Setup:</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ComPlat/chemotion_ELN" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELN GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ComPlat/chemotion_REPO" target="_blank" rel="noopener noreferrer" class="footer__link-item">Repository GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/chemotionsaurus/about">Contact Us</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/chemotionsaurus/admin">Admin</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Chemotion - KIT. Built with Docusaurus.</div></div></div></footer></div>
<script src="/chemotionsaurus/assets/js/runtime~main.cd4bfac8.js"></script>
<script src="/chemotionsaurus/assets/js/main.63004e89.js"></script>
</body>
</html>