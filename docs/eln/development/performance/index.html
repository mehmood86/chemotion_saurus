<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-eln/development/performance">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Investigating performance | Chemotion</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://chemotion.net/chemotionsaurus/docs/eln/development/performance"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Investigating performance | Chemotion"><meta data-rh="true" name="description" content="Poor performance is bad for user experience."><meta data-rh="true" property="og:description" content="Poor performance is bad for user experience."><link data-rh="true" rel="icon" href="/chemotionsaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chemotion.net/chemotionsaurus/docs/eln/development/performance"><link data-rh="true" rel="alternate" href="https://chemotion.net/chemotionsaurus/docs/eln/development/performance" hreflang="en"><link data-rh="true" rel="alternate" href="https://chemotion.net/chemotionsaurus/docs/eln/development/performance" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/chemotionsaurus/blog/rss.xml" title="Chemotion RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/chemotionsaurus/blog/atom.xml" title="Chemotion Atom Feed"><link rel="stylesheet" href="/chemotionsaurus/assets/css/styles.635859be.css">
<link rel="preload" href="/chemotionsaurus/assets/js/runtime~main.dd07eda5.js" as="script">
<link rel="preload" href="/chemotionsaurus/assets/js/main.798d2ac8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/chemotionsaurus/"><div class="navbar__logo"><img src="/chemotionsaurus/img/favicon.ico" alt="Chemotion" class="themedImage_ToTc themedImage--light_HNdA"><img src="/chemotionsaurus/img/favicon.ico" alt="Chemotion" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Chemotion</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/chemotionsaurus/docs/eln/intro">ELN</a></li><li><a class="dropdown__link" href="/chemotionsaurus/docs/repo/videos_repo">Repository</a></li><li><a class="dropdown__link" href="/chemotionsaurus/docs/docu/maintaining">About this documentation</a></li></ul></div><a class="navbar__item navbar__link" href="/chemotionsaurus/blog/newsroom">Newsroom</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/chemotionsaurus/docs/category/installation">ELN Chemotion and LabIMotion</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/chemotionsaurus/docs/category/installation">Installation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/chemotionsaurus/docs/category/development">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/development/project_overview">Project overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/development/learning_resources">Learning resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/development/architecture">Application architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/development/debugging">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/development/linting">Linting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/development/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/development/ci">Continuous integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/chemotionsaurus/docs/eln/development/performance">Investigating performance</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/chemotionsaurus/docs/category/configuration">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/chemotionsaurus/docs/category/manual-chemotion-eln">Manual Chemotion ELN</a><button aria-label="Toggle the collapsible sidebar category &#x27;Manual Chemotion ELN&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/chemotionsaurus/docs/eln/labimotion">Manual LabIMotion ELN</a><button aria-label="Toggle the collapsible sidebar category &#x27;Manual LabIMotion ELN&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/chemotionsaurus/docs/category/admin-ui">Admin UI</a><button aria-label="Toggle the collapsible sidebar category &#x27;Admin UI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/chemotionsaurus/docs/category/device-integration">Device integration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Device integration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/faq_eln">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chemotionsaurus/docs/eln/specific_contact">Contact</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/chemotionsaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ELN Chemotion and LabIMotion</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/chemotionsaurus/docs/category/development"><span itemprop="name">Development</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Investigating performance</span><meta itemprop="position" content="3"></li></ul></nav><div class="theme-doc-markdown markdown"><header><h1>Investigating performance</h1></header><p>Poor performance is bad for user experience.
If you notice that parts of the ELN don&#x27;t perform as well as you&#x27;d like,
it might be helpful to find out <em>why</em> that is the case, and how you could improve it.
This chapter provides some guidance on how to investigate performance.</p><p>We follow the example of investigating the performance of creating a reaction.
We&#x27;ll only deal with the backend for the moment, meaning the performance investigation will be limited to Ruby.</p><p>For a good general primer on performance investigations have a look at <a href="https://youtu.be/XL51vf-XBTs" target="_blank" rel="noopener noreferrer">https://youtu.be/XL51vf-XBTs</a>.</p><h1>Isolating the issue</h1><p>Once you&#x27;ve identified a performance issue (e.g., creating a reaction is slow), you need a quick, repeatable way to reproduce it.
This is why we start by setting up an <code>rspec</code> test (<a href="https://rspec.info" target="_blank" rel="noopener noreferrer">https://rspec.info</a>) to isolate the issue.</p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">spec/api/reaction_api_performance_spec.rb</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># frozen_string_literal: true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;rails_helper&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">describe </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;Reaction API POST&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:root_container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:root_container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:collection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> Collection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">label</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;Collection&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">user</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:reaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:reaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;Reaction&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">collections</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">collection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;Sample&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">container</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> FactoryBot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:molfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">File</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Rails</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">root </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;spec/fixtures/test_2.mol&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;r001&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;collection_id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> collection</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;container&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> root_container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;materials&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;starting_materials&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;starting_material&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;target_amount_unit&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;mg&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;target_amount_value&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">75.09596</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;equivalent&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;reference&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;is_new&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;molfile&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> molfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;container&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> root_container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;reactants&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;target_amount_unit&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;mg&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;target_amount_value&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">86.09596</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;equivalent&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;reference&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;is_new&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;molfile&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> molfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;container&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> root_container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;parent_id&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># gets named after parent, hence no name specified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;products&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;product&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;target_amount_unit&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;mg&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;target_amount_value&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">99.08304</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;equivalent&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;reference&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;is_new&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;molfile&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> molfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;container&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> root_container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;solvents&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;solvent&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;target_amount_unit&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;mg&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;target_amount_value&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">76.09596</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;equivalent&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;reference&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;is_new&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;molfile&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> molfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;container&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> root_container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  before </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_any_instance_of</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">WardenAuthentication</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">to receive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">:current_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">and_return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ReactionsStartingMaterialSample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token symbol">reaction</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> reaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">sample</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">reference</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">equivalent</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  it </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;creates reaction in under one second&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">:profile</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    post </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;/api/v1/reactions&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">params</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">as</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token symbol">:json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Benchmarking</h1><p>The goal of a performance investigation is to eventually improve performance.
In order for those improvements to be objective, we need a baseline:
How long does it take (on your system) to create a reaction? If you have that number,
you have a target for your improvements.
You can quantifying performance by using a benchmarking tool.
We use <code>rspec-benchmark</code> (<a href="https://github.com/piotrmurach/rspec-benchmark" target="_blank" rel="noopener noreferrer">https://github.com/piotrmurach/rspec-benchmark</a>) to benchmark the <code>rspec</code> test we set up earlier.
After installing the framework (<code>bundle add rspec-benchmark</code>) you can make it available as follows.</p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">spec/spec_helper.rb</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;rspec-benchmark&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RSpec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">configure </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">config</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">include</span><span class="token plain"> RSpec</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">Benchmark</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">Matchers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You&#x27;re now ready to include <code>rspec-benchmark</code> syntax / DSL in you test (for details head over to the <code>rspec-benchmark</code> docs):</p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">spec/api/reaction_api_performance_spec.rb</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">it </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;creates reaction in under one second&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expect </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> post </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;/api/v1/reactions&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">params</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">as</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token symbol">:json</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">to perform_under</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">times</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">times</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We extended the test such that it&#x27;s executed 100 times (in order to get statistically meaningful results),
and we expect the creation of a reaction to be done in under one second.
When running the test, we get the following report.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">reaction API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  creates reaction in under one second (FAILED - 1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Failures:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1) reaction API creates reaction in under one second</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Failure/Error: expect { post &#x27;/api/v1/reactions&#x27;, params: params, as: :json }.to perform_under(1000).ms.warmup(1).times.sample(100).times</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       expected block to perform under 1 sec, but performed above 2.31 sec ( 452 ms)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We now have an impression of how long it takes on average to create a reaction on your system.
You can use this baseline to start improving the performance.</p><h1>Profiling</h1><p>In order to improve performance, we now need to identify hot spots in the code that lend themselves for optimization.
Profiling can help finding these hot spots by breaking down how much time (or CPU cycles) a program spends in each of its components (e.g., methods).
We can use the <code>stackprof</code> (<a href="https://github.com/tmm1/stackprof" target="_blank" rel="noopener noreferrer">https://github.com/tmm1/stackprof</a>) gem to profile our <code>rspec</code> test.
After installing the gem with <code>bundle add stackprof</code> we need to configure it as follows.</p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">spec/spec_helper.rb</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;stackprof&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RSpec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">configure </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">config</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">around </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">example</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token symbol">:profile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      StackProf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">mode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token symbol">:wall</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">interval</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">250000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">raw</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">out</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;tmp/stackprof.dump&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;re specifying that we want to sample the call stack every 250000 microseconds and that we want to write the profiling results to <code>tmp/stackprof.dump</code>.
Finally, we can mark our test for profiling by adding the <code>:profile</code> keyword.</p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">spec/api/reaction_api_performance_spec.rb</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">it </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;creates reaction in under one second&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">:profile</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expect </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> post </span><span class="token string-literal string" style="color:rgb(195, 232, 141)">&#x27;/api/v1/reactions&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">params</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token symbol">as</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token symbol">:json</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">to perform_under</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">times</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">times</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After running the test, we can visualize the profiling results by having <code>stackprof</code> construct an interactive flamegraph that you can inspect in your browser.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">bundle exec stackprof --d3-flamegraph tmp/stackprof.dump &gt; tmp/stackprof-flamegraph.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Have a look at the following resources for details on how to read flamegraphs:</p><ul><li><a href="https://youtu.be/6uKZXIwd6M0" target="_blank" rel="noopener noreferrer">https://youtu.be/6uKZXIwd6M0</a> (5:20-13:00)</li><li><a href="https://www.brendangregg.com/flamegraphs.html" target="_blank" rel="noopener noreferrer">https://www.brendangregg.com/flamegraphs.html</a></li></ul><p><code>stackprof</code> can also break down how much time the tests spends on each line of a function call.
This can help zooming in on hot spots.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">bundle exec stackprof tmp/stackprof-wall.dump --method ReactionHelpers#update_materials_for_reaction</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The result looks as follows. For example, it looks like the call to <code>.save!</code> on line 163 might be a good candidate for further investigation.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ReactionHelpers#update_materials_for_reaction (/workspace/chemotion/app/api/chemotion/reaction_api.rb:48)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  samples:     0 self (0.0%)  /    568 total (54.9%)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  callers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1038  (  182.7%)  ReactionHelpers#update_materials_for_reaction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     568  (  100.0%)  block (2 levels) in &lt;class:ReactionAPI&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     520  (   91.5%)  ActiveRecord::ConnectionAdapters::DatabaseStatements#transaction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  callees (568 total):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1038  (  182.7%)  ReactionHelpers#update_materials_for_reaction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     520  (   91.5%)  ActiveRecord::Transactions::ClassMethods#transaction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     411  (   72.4%)  ActiveRecord::Suppressor#save!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      59  (   10.4%)  ActiveRecord::Persistence::ClassMethods#create!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      49  (    8.6%)  Sample#create_subsample</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      10  (    1.8%)  ActiveRecord::Associations::CollectionProxy#&lt;&lt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      10  (    1.8%)  ContainerHelpers#update_datamodel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       9  (    1.6%)  Sample::GeneratedAssociationMethods#container=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       7  (    1.2%)  ActiveRecord::Persistence#update!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       3  (    0.5%)  ActiveRecord::Core::ClassMethods#find_by</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       3  (    0.5%)  ActiveRecord::Core::ClassMethods#find</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       2  (    0.4%)  ActiveRecord::Inheritance::ClassMethods#new</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       1  (    0.2%)  Sample::GeneratedAssociationMethods#collections</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       1  (    0.2%)  ActiveRecord::Relation#destroy_all</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       1  (    0.2%)  ActiveRecord::Delegation#[]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       1  (    0.2%)  ActiveRecord::Aggregations#reload</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       1  (    0.2%)  Segmentable#save_segments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  code:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    48  |   def update_materials_for_reaction(reaction, material_attributes, current_user)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    49  |     collections = reaction.collections</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    50  |     materials = OpenStruct.new(material_attributes)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    51  |     materials = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    52  |       starting_material: Array(material_attributes[&#x27;starting_materials&#x27;]).map { |m| OSample.new(m) },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    53  |       reactant: Array(material_attributes[&#x27;reactants&#x27;]).map { |m| OSample.new(m) },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    54  |       solvent: Array(material_attributes[&#x27;solvents&#x27;]).map { |m| OSample.new(m) },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    55  |       purification_solvent: Array(material_attributes[&#x27;purification_solvents&#x27;]).map { |m| OSample.new(m) },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    56  |       product: Array(material_attributes[&#x27;products&#x27;]).map { |m| OSample.new(m) }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    57  |     }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  520   (50.3%)                   |    58  |     ActiveRecord::Base.transaction do</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    59  |       included_sample_ids = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  519   (50.2%)                   |    60  |       materials.each do |material_group, samples|</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    61  |         fixed_label = material_group =~ /solvents?|reactants?/ &amp;&amp; $&amp;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    62  |         reactions_sample_klass = &quot;Reactions#{material_group.to_s.camelize}Sample&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  519   (50.2%)                   |    63  |         samples.each_with_index do |sample, idx|</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    64  |           sample.position = idx if sample.position.nil?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    65  |           sample.reference = false if material_group === &#x27;solvent&#x27; &amp;&amp; sample.reference == true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    66  |           # create new subsample</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    67  |           if sample.is_new</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    68  |             if sample.parent_id &amp;&amp; material_group != &#x27;products&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1    (0.1%)                   |    69  |               parent_sample = Sample.find(sample.parent_id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    70  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    71  |               # TODO: extract subsample method</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   49    (4.7%)                   |    72  |               subsample = parent_sample.create_subsample(current_user, collections, true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    73  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    74  |               # Use &#x27;reactant&#x27; or &#x27;solvent&#x27; as short_label</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    75  |               subsample.short_label = fixed_label if fixed_label</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    76  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    77  |               subsample.target_amount_value = sample.target_amount_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    78  |               subsample.target_amount_unit = sample.target_amount_unit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    79  |               subsample.real_amount_value = sample.real_amount_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    80  |               subsample.real_amount_unit = sample.real_amount_unit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    81  |               subsample.metrics = sample.metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    82  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    83  |               # add new data container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    84  |               # subsample.container = create_root_container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3    (0.3%)                   |    85  |               subsample.container = update_datamodel(sample.container) if sample.container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   18    (1.7%)                   |    86  |               subsample.save!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1    (0.1%)                   |    87  |               subsample.reload</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1    (0.1%)                   |    88  |               subsample.save_segments(segments: parent_sample.segments, current_user_id: current_user.id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    89  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    90  |               included_sample_ids &lt;&lt; subsample.id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    91  |               s_id = subsample.id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    92  |             # create new sample</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    93  |             else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    94  |               attributes = sample.to_h.except(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    95  |                 :id, :is_new, :is_split, :reference, :equivalent, :position,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    96  |                 :type, :molecule, :collection_id, :short_label, :waste, :show_label, :coefficient, :user_labels,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    97  |                 :boiling_point_lowerbound, :boiling_point_upperbound,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    98  |                 :melting_point_lowerbound, :melting_point_upperbound, :segments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |    99  |               ).merge(created_by: current_user.id,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   100  |                       boiling_point: rangebound(sample.boiling_point_lowerbound, sample.boiling_point_upperbound),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   101  |                       melting_point: rangebound(sample.melting_point_lowerbound, sample.melting_point_upperbound))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   102  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   103  |               # update attributes[:name] for a copied reaction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   104  |               if (reaction.name || &#x27;&#x27;).include?(&#x27;Copy&#x27;) &amp;&amp; attributes[:name].present?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   105  |                 named_by_reaction = &quot;#{reaction.short_label}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   106  |                 named_by_reaction += &quot;-#{attributes[:name].split(&#x27;-&#x27;).last}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   107  |                 attributes.merge!(name: named_by_reaction)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   108  |               end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   109  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   110  |               container_info = attributes[:container]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   111  |               attributes.delete(:container)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   112  |               attributes.delete(:segments)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2    (0.2%)                   |   113  |               new_sample = Sample.new(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   114  |                 attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   115  |               )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   116  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   117  |               # Use &#x27;reactant&#x27; or &#x27;solvent&#x27; as short_label</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   118  |               new_sample.short_label = fixed_label if fixed_label</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   119  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   120  |               # add new data container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    6    (0.6%)                   |   121  |               new_sample.container = update_datamodel(container_info)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   122  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   11    (1.1%)                   |   123  |               new_sample.collections &lt;&lt; collections</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  106   (10.3%)                   |   124  |               new_sample.save!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   125  |               new_sample.save_segments(segments: sample.segments, current_user_id: current_user.id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   126  |               included_sample_ids &lt;&lt; new_sample.id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   127  |               s_id = new_sample.id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   128  |             end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   58    (5.6%)                   |   129  |             ReactionsSample.create!(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   130  |               sample_id: s_id,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   131  |               reaction_id: reaction.id,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   132  |               equivalent: sample.equivalent,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   133  |               reference: sample.reference,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   134  |               show_label: sample.show_label,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   135  |               waste: sample.waste,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   136  |               coefficient: sample.coefficient,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   137  |               position: sample.position,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   138  |               type: reactions_sample_klass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   139  |             ) if s_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   140  |             s_id = nil</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   141  |           # update the existing sample</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   142  |           else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2    (0.2%)                   |   143  |             existing_sample = Sample.find(sample.id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   144  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   145  |             existing_sample.target_amount_value = sample.target_amount_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   146  |             existing_sample.target_amount_unit = sample.target_amount_unit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   147  |             existing_sample.real_amount_value = sample.real_amount_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   148  |             existing_sample.real_amount_unit = sample.real_amount_unit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   149  |             existing_sample.metrics = sample.metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   150  |             existing_sample.external_label = sample.external_label if sample.external_label</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   151  |             existing_sample.short_label = sample.short_label if sample.short_label</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   152  |             existing_sample.short_label = fixed_label if fixed_label</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   153  |             existing_sample.name = sample.name if sample.name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   154  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1    (0.1%)                   |   155  |             if r = existing_sample.residues[0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   156  |               r.assign_attributes sample.residues_attributes[0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   157  |             end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   158  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   159  |             if sample.container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   10    (1.0%)                   |   160  |               existing_sample.container = update_datamodel(sample.container)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   161  |             end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   162  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  239   (23.1%)                   |   163  |             existing_sample.save!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   164  |             existing_sample.save_segments(segments: sample.segments, current_user_id: current_user.id) if sample.segments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   165  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   166  |             included_sample_ids &lt;&lt; existing_sample.id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   167  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3    (0.3%)                   |   168  |             existing_association = ReactionsSample.find_by(sample_id: sample.id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   169  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   170  |             # update existing associations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   171  |             if existing_association</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    7    (0.7%)                   |   172  |               existing_association.update_attributes!(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   173  |                 reaction_id: reaction.id,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   174  |                 equivalent: sample.equivalent,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   175  |                 reference: sample.reference,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   176  |                 show_label: sample.show_label,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   177  |                 waste: sample.waste,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   178  |                 coefficient: sample.coefficient,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   179  |                 position: sample.position,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   180  |                 type: reactions_sample_klass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   181  |               )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   182  |             # sample was moved to other materialgroup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   183  |             else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   184  |               # create a new association</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1    (0.1%)                   |   185  |               ReactionsSample.create!(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   186  |                 sample_id: sample.id,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   187  |                 reaction_id: reaction.id,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   188  |                 equivalent: sample.equivalent,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   189  |                 reference: sample.reference,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   190  |                 show_label: sample.show_label,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   191  |                 waste: sample.waste,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   192  |                 coefficient: sample.coefficient,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   193  |                 position: sample.position,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   194  |                 type: reactions_sample_klass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   195  |               )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   196  |             end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   197  |           end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   198  |         end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   199  |       end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   200  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   201  |       # delete all samples not anymore in one of the groups</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   202  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   203  |       current_sample_ids = reaction.reactions_samples.pluck(:sample_id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   204  |       deleted_sample_ids = current_sample_ids - included_sample_ids</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1    (0.1%)                   |   205  |       Sample.where(id: deleted_sample_ids).destroy_all</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   206  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   207  |       # for testing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   208  |       # raise ActiveRecord::Rollback</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   209  |     end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   210  |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   211  |     # to update the SVG</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   212  |     reaction.reload</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   48    (4.6%)                   |   213  |     reaction.save!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  |   214  |   end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ComPlat/chemotion_saurus/edit/master/docs/eln/development/performance.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-09-16T06:28:13.000Z">Sep 16, 2022</time></b> by <b>Danny Truong</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/chemotionsaurus/docs/eln/development/ci"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Continuous integration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/chemotionsaurus/docs/category/configuration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configuration</div></a></nav></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ComPlat/chemotion_ELN" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELN GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ComPlat/chemotion_REPO" target="_blank" rel="noopener noreferrer" class="footer__link-item">Repository GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/chemotionsaurus/about">Contact Us</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/chemotionsaurus/admin">Admin</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright  2022 Chemotion - KIT. Built with Docusaurus.</div></div></div></footer></div>
<script src="/chemotionsaurus/assets/js/runtime~main.dd07eda5.js"></script>
<script src="/chemotionsaurus/assets/js/main.798d2ac8.js"></script>
</body>
</html>